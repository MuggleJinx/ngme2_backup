---
title: "Untitled"
author: "Xiaotian Jin"
date: "3/22/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
load_all()
```

# test f function

```{r}
y=1:4; x1=1:4; x2=3:6
df = data.frame(y=1:4, x1=1:4, x2=3:6)
f(x1, model = "ar1", data=df)
```

# test interpret.formula

```{r}
ngme.interpret.formula(y ~ x1 + x2 + f(x1, model = "ar1", data=df), data=df, debug=F)
ngme.interpret.formula(y ~ f(x1, model = "ar1", data=df) + 
                           f(x2, model = "ar1", data=df) , data=df, debug=F)
```


```{r}
load_all()
ngme(formula=y ~ x1 + f(x1, model = "ar1"),
             data=df,
             family  = "gaussian",
             init    = list(),
             controls = list(iterations=10,
                             gibbs_sample=5,
                             stepsize=0.3)
             )
# eval(x, envir=list(x=5))
```


```{r}
alpha <- 0.5
n_obs <- 10
mu <- 2
delta <- -mu
nu <-  1.5
sigma <- 2
sigma_eps <- 1

trueV <- ngme2::rig(n_obs, nu, nu) 
noise <- delta + mu*trueV + sigma * sqrt(trueV) * rnorm(n_obs)

trueW <- Reduce(function(x,y){y + alpha*x}, noise, accumulate = T)
Y <- trueW + rnorm(n_obs, mean=0, sd=sqrt(sigma_eps))

########### generate input list 

a_init <- 0.1
nu_init <- 2
```


```{r}

y=Y; x=1:length(Y); x2=x^2;
df <- data.frame(y=y, x=x, x2=x2)
out <- ngme(y ~ x + f(x, model="ar1", var="NIG") + f(x2, model="ar1", var="NIG"), 
            family="gaussian", 
            data=df,
            iterations=10,
            gibbs_sample = 10,
            stepsize = 0.5)
out

```

```{r}
plot_out(out)
```


what is covariates here? 

```{r}
    ngme.interpret.formula(y ~ f(x, model="AR1", var="NIG"), debug=T)
```
